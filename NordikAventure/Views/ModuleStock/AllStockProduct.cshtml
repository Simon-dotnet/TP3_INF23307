@model Nordik_Aventure.Objects.Models.Stock
@{
    Layout = "_StockLayout";
    var list = Model.Products;
}

<div class="container-fluid">
    <div class="row justify-content-between align-items-center mb-4">

        <div class="col-lg-7 col-md-6 mb-3 mb-md-0">
            <h3 class="fw-semibold mb-1">Liste des produits en stock</h3>

            <div class="d-flex flex-wrap gap-3 mt-2">

                <div class="d-flex align-items-center">
                    <span class="fw-bold me-2 text-secondary">Quantité totale :</span>
                    <span style="background-color: var(--background-main)" class="badge fs-6">@Model.TotalProducts</span>
                </div>

                <div class="d-flex align-items-center">
                    <span class="fw-bold me-2 text-secondary">Dernière update :</span>
                    <span style="background-color: var(--background-main)" class="badge fs-6">
                        @Model.LastUpdate.ToString("yyyy-MM-dd")
                    </span>
                </div>

            </div>
        </div>

        <div class="col-lg-5 col-md-6 text-md-end">
            <input id="searchInput"
                   oninput="FilterList()"
                   type="text"
                   class="form-control w-75 d-inline-block"
                   placeholder="Recherche par nom..."/>
        </div>
    </div>

    <hr/>
    <div class="row mb-4 cards-container py-4 px-2">
        @foreach (var p in list)
        {
            <div class="col-md-6 mb-4" id="product-card-zone" data-name="@p.Product.Name.ToLower()">
                <div class="product-card">
                    <div class="header d-flex justify-content-between align-items-center">
                        <div class="info d-flex align-items-center gap-2">
                            <p class="name mb-0">(@p.Product.Sku) @p.Product.Name</p>

                            @if (p.QuantityInStock <= p.Threshold)
                            {
                                <span class="badge" style="background-color: var(--alert-red); font-size: 12px">À commander</span>
                            }
                        </div>

                        <div class="status">
                            @if (p.Status == "Actif")
                            {
                                <span class="status-actif">● Actif</span>
                            }
                            else
                            {
                                <span class="status-inactif">● Inactif</span>
                            }
                        </div>
                    </div>

                    <div class="card-content">
                        <p>
                            <strong>Emplacement:</strong> @p.StorageLocation
                        </p>
                        <p>
                            <strong>Quantité:</strong> @p.QuantityInStock
                        </p>
                        <p style="font-size: 14px" class="text-muted">
                            <strong>Seuil:</strong> @p.Threshold
                        </p>
                    </div>

                    <div class="text-center mt-2">
                        <a href=@Url.Action("DisplayProductStock", "Stock", new { id = p.Id }) class="btn w-50" style="background-color: var(--background-button); color: var(--text-white);">
                            Consulter détails
                        </a>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

<script>
    function FilterList() {
        let word = document.getElementById("searchInput").value.toLowerCase();
        let cards = document.querySelectorAll("#product-card-zone");

        if (word.length === 0){
        cards.forEach(card => {
            card.style.display = "block"
        })
        }
        cards.forEach(card => {
            let name = card.getAttribute("data-name");
            card.style.display = name.startsWith(word) ? "block" : "none";
        });
    }
</script>