@model Nordik_Aventure.Objects.ViewModels.SupplierReceiptViewModel
@{
Layout = "_FinanceLayout";
}

<style>
    @@media print {
        .no-print,
        header,
        nav,
        .navbar,
        .sidebar,
        .topbar {
            display: none !important;
            visibility: hidden !important;
            height: 0 !important;
        }

        body {
            margin: 0;
            padding: 0;
            background: white;
        }

        #receipt {
            width: 100%;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        h2, h4 {
            margin-top: 0;
        }
    }
</style>

<div id="receipt">

    <h2>Facture de la commande #@Model.SupplierReceiptId</h2>

    <div class="mb-3">
        <strong>Date :</strong>
        @(Model.Transaction?.Date.ToString("dd/MM/yyyy HH:mm") ?? DateTime.Now.ToString("dd/MM/yyyy HH:mm"))
    </div>

    <h4>Produits</h4>
    <table class="table table-striped">
        <thead>
        <tr>
            <th>Produit</th>
            <th>SKU</th>
            <th>Fournisseur</th>
            <th>Quantit√©</th>
            <th>Prix unitaire</th>
            <th>Prix total</th>
        </tr>
        </thead>
        <tbody>
        @if (Model.Purchase?.PurchaseDetails != null)
        {
        foreach (var pd in Model.Purchase.PurchaseDetails)
        {
        var lineTotal = pd.Quantity * (pd.Product?.PriceToBuy ?? 0);
        <tr>
            <td>@(pd.Product?.Name ?? "-")</td>
            <td>@(pd.Product?.Sku ?? "-")</td>
            <td>@(pd.Product?.Supplier?.Name ?? "-")</td>
            <td>@pd.Quantity</td>
            <td>@(pd.Product?.PriceToBuy.ToString("N2") ?? "0.00") $</td>
            <td>@lineTotal.ToString("N2") $</td>
        </tr>
        }
        }
        </tbody>
    </table>

    @{
    var subtotal = Model.Purchase?.PurchaseDetails?.Sum(pd => pd.Quantity * (pd.Product?.PriceToBuy ?? 0.0)) ?? 0;
    var tps = subtotal * ((Model.Taxes?.ValueTps ?? 0) / 100.0);
    var tvq = subtotal * ((Model.Taxes?.ValueTvq ?? 0) / 100.0);
    var total = subtotal + tps + tvq;
    }

    <div class="text-end">
        <p>Sous-total : <strong>@subtotal.ToString("N2") $</strong></p>
        <p>TPS (@(Model.Taxes?.ValueTps ?? 0)%) : <strong>@tps.ToString("N2") $</strong></p>
        <p>TVQ (@(Model.Taxes?.ValueTvq ?? 0)%) : <strong>@tvq.ToString("N2") $</strong></p>
        <h4>Total : <strong>@total.ToString("N2") $</strong></h4>
    </div>
</div>

<div class="mt-3 no-print">
    <a class="btn btn-secondary" href="@Url.Action("OrderHistory", "Order")">Retour</a>
    <button class="btn btn-primary" style="background-color: var(--background-button); color: var(--text-white);" onclick="window.print()">Imprimer/Exporter</button>
</div>
