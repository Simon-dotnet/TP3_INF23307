@model List<GestBibli.Objects.ViewModels.OrderHistoryViewModel>
@{
    Layout = "_FinanceLayout";
}

<style>
    .order-table {
        table-layout: fixed;
        width: 100%;
    }

    .order-table th:nth-child(1),
    .order-table td:nth-child(1) {
        width: 40%;
    }

    .order-table th:nth-child(2),
    .order-table td:nth-child(2) {
        width: 30%;
    }

    .order-table th:nth-child(3),
    .order-table td:nth-child(3) {
        width: 15%;
        text-align: center;
    }

    .order-table th:nth-child(4),
    .order-table td:nth-child(4) {
        width: 15%;
        text-align: right;
    }
</style>

<div class="container mt-4">
    <h1 class="mb-4">Historique des commandes</h1>

    <div class="mb-4 p-3 border rounded bg-light">
        <div class="d-flex justify-content-between">

            <div>
                <div class="text-muted small">Total</div>
                <div class="fw-bold">@Model.Count</div>
            </div>

            <div>
                <div class="text-muted small">Réception</div>
                <span class="badge bg-secondary">
                    @Model.Count(o => o.Status == "réception")
                </span>
            </div>

            <div>
                <div class="text-muted small">Préparation</div>
                <span class="badge bg-info text-dark">
                    @Model.Count(o => o.Status == "préparation")
                </span>
            </div>

            <div>
                <div class="text-muted small">Expédiée</div>
                <span class="badge bg-primary">
                    @Model.Count(o => o.Status == "expédiée")
                </span>
            </div>

            <div>
                <div class="text-muted small">Facturée</div>
                <span class="badge bg-warning text-dark">
                    @Model.Count(o => o.Status == "facturée")
                </span>
            </div>

            <div>
                <div class="text-muted small">Payée/Fermée</div>
                <span class="badge bg-success">
                    @Model.Count(o => o.Status == "payée/fermée")
                </span>
            </div>

        </div>
    </div>

    <section class="mb-5 cards-container">
        @if (!Model.Any())
        {
            <p class="text-muted">Aucune commande pour l'instant</p>
        }
        else
        {
            @foreach (var order in Model)
            {
                <div class="mb-3 border p-3 rounded bg-white">
                    <div class="d-flex justify-content-between">
                        <h5 class="m-0">
                            Commande #@order.OrderId  
                            • @order.DateOfOrdering.ToString("dd/MM/yyyy")  
                            • @($"{order.TotalPrice:N2}".Replace('.', ','))$
                        </h5>

                        <div>
                            @switch(order.Status)
                            {
                                case "réception":
                                    <span class="badge bg-secondary">@order.Status</span>; break;
                                case "préparation":
                                    <span class="badge bg-info text-dark">@order.Status</span>; break;
                                case "expédiée":
                                    <span class="badge bg-primary">@order.Status</span>; break;
                                case "facturée":
                                    <span class="badge bg-warning text-dark">@order.Status</span>; break;
                                case "payée/fermée":
                                    <span class="badge bg-success">@order.Status</span>; break;
                                default:
                                    <span class="badge bg-dark">@order.Status</span>; break;
                            }
                        </div>
                    </div>

                    <div class="text-muted small mb-2">
                        Livraison prévue: @order.DateOfDelivery.ToString("dd/MM/yyyy")
                    </div>

                    <table class="table table-sm table-bordered mt-2 order-table">
                        <thead>
                        <tr>
                            <th>Produit</th>
                            <th>Fournisseur</th>
                            <th>Quantité</th>
                            <th>Prix total</th>
                        </tr>
                        </thead>
                        <tbody>
                        @foreach (var item in order.Items)
                        {
                            <tr>
                                <td>@item.ProductName</td>
                                <td>@item.SupplierName</td>
                                <td>@item.Quantity</td>
                                <td>@($"{item.TotalPrice:N2}".Replace('.', ','))$</td>
                            </tr>
                        }
                        </tbody>
                    </table>
                </div>
            }
        }
    </section>
</div>